<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Professional TDS & GST deduction calculator for freelancers, contractors, and businesses. Calculate deductions, track bills, export to Excel/PDF, and work offline." />
    <meta name="keywords" content="TDS calculator, GST calculator, tax deduction, freelance, contractor, invoice, billing" />
    <meta name="author" content="SubhanRaj" />
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4CAF50" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="TDS Calculator" />
    <meta name="application-name" content="TDS Calculator" />
    <meta name="msapplication-TileColor" content="#4CAF50" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' rx='40' fill='%234CAF50'/%3E%3Ctext x='90' y='70' font-family='Arial, sans-serif' font-size='65' font-weight='bold' fill='white' text-anchor='middle'%3Eâ‚¹%3C/text%3E%3Crect x='35' y='90' width='110' height='12' rx='6' fill='white'/%3E%3Ctext x='90' y='135' font-family='Arial, sans-serif' font-size='24' font-weight='bold' fill='white' text-anchor='middle'%3ETDS%3C/text%3E%3C/svg%3E" />
    
    <title>TDS & GST Deduction Calculator</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='15' fill='%234CAF50'/%3E%3Ctext x='50' y='38' font-family='Arial, sans-serif' font-size='40' font-weight='bold' fill='white' text-anchor='middle'%3Eâ‚¹%3C/text%3E%3Crect x='20' y='50' width='60' height='6' rx='3' fill='white'/%3E%3Ctext x='50' y='75' font-family='Arial, sans-serif' font-size='14' font-weight='bold' fill='white' text-anchor='middle'%3ETDS%3C/text%3E%3C/svg%3E" />
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="style.css" />
</head>

<body class="bg-light p-4">
    <div class="container bg-white p-4 shadow rounded">
        <h2 class="mb-4 text-center">TDS & GST Deduction Calculator</h2>
        
        <!-- Company Info Section -->
        <div class="mb-4 p-3 bg-light border rounded">
            <div class="row">
                <div class="col-md-6 col-12 mb-2">
                    <label class="form-label"><strong>Company/Your Name:</strong></label>
                    <input type="text" id="companyName" class="form-control" placeholder="Enter company or your name" />
                </div>
                <div class="col-md-6 col-12 mb-2">
                    <label class="form-label"><strong>PAN Number:</strong></label>
                    <input type="text" id="panNumber" class="form-control" placeholder="Optional PAN number" maxlength="10" />
                </div>
            </div>
        </div>

        <!-- Summary Dashboard -->
        <div class="mb-4 p-3 bg-info bg-opacity-10 border border-info rounded" id="summaryDashboard" style="display: none;">
            <h5 class="mb-3"><i class="fas fa-chart-line"></i> Summary Dashboard</h5>
            <div class="row text-center">
                <div class="col-md-3 col-6 mb-2">
                    <div class="p-2 bg-white rounded shadow-sm">
                        <small class="text-muted d-block">Total Bills</small>
                        <strong class="fs-5 text-primary" id="dashTotalBills">0</strong>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-2">
                    <div class="p-2 bg-white rounded shadow-sm">
                        <small class="text-muted d-block">Avg. Deduction</small>
                        <strong class="fs-5 text-success" id="dashAvgDeduction">0%</strong>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-2">
                    <div class="p-2 bg-white rounded shadow-sm">
                        <small class="text-muted d-block">Highest Bill</small>
                        <strong class="fs-5 text-warning" id="dashHighest">â‚¹0</strong>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-2">
                    <div class="p-2 bg-white rounded shadow-sm">
                        <small class="text-muted d-block">Date Range</small>
                        <strong class="fs-6 text-secondary" id="dashDateRange">-</strong>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-4 p-3 bg-light border rounded justify-content-center">
            <p class="text-justify">
                This is a simple tool to calculate TDS (Tax Deducted at Source) and
                GST (Goods and Services Tax) deduction from the payments received from
                the payments made by government or private companies which are subject
                to TDS and GST deduction. You can add multiple bills and calculate the
                total deduction and received amount as well as the individual
                deduction for each bill.
            </p>
        </div>

        <div class="mb-4 p-3 bg-light border rounded">
            <div class="row">
                <div class="col-md-4 col-12">
                    <label class="form-label"><strong>Enter Total Billed Amount:</strong></label>
                    <input type="number" id="manualBilled" class="form-control mb-2" min="0" step="0.01" />
                </div>
                <div class="col-md-4 col-12">
                    <label class="form-label"><strong>Enter Total Received Amount:</strong></label>
                    <input type="number" id="manualReceived" class="form-control mb-2" min="0" step="0.01" />
                </div>
                <div class="col-md-4 col-12">
                    <label class="form-label"><strong>Deduction Percentage:</strong></label>
                    <select id="deductionPercentageSelect" class="form-select mb-2" onchange="handlePercentageChange()">
                        <option value="auto">Auto (Default Logic)</option>
                        <option value="2.24">2.24% (TDS Only)</option>
                        <option value="2.40">2.40%</option>
                        <option value="2.43">2.43%</option>
                        <option value="4.24">4.24% (2% GST + 2.24% TDS)</option>
                        <option value="custom">Custom Percentage</option>
                    </select>
                    <input type="number" id="customPercentage" class="form-control" placeholder="Enter custom %" step="0.01" style="display: none;" onblur="applyCustomPercentage()" />
                </div>
            </div>
            <div class="row mt-3 text-center">
                <div class="col-12 d-flex flex-column flex-md-row gap-2">
                    <button onclick="manualCalculation()" class="btn btn-primary flex-grow-1 mb-2 mb-md-0">
                        Calculate
                    </button>
                    <button onclick="clearFields()" class="btn btn-secondary flex-grow-1">
                        Clear
                    </button>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6 col-12">
                    <strong>Deducted Amount:</strong> â‚¹<span id="manualDeduction">0.00</span>
                </div>
                <div class="col-md-6 col-12">
                    <strong>Deduction Percentage & Type:</strong>
                    <span id="manualDeductionPercentage">0.00%</span>
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered" id="billTable">
                <thead class="table-light text-center">
                    <tr>
                        <th style="width: 50px;">
                            <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" title="Select all bills" aria-label="Select all bills">
                        </th>
                        <th>Bill Number</th>
                        <th>Date</th>
                        <th>Bill Amount (â‚¹)</th>
                        <th>Deduction (â‚¹)</th>
                        <th>Deduction Percentage & Type</th>
                        <th>Amount Received (â‚¹)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="text-center my-3 d-flex flex-column flex-md-row gap-2 justify-content-center">
            <button onclick="addRow()" class="btn btn-primary mb-2 mb-md-0" title="Ctrl/Cmd + N">
                <i class="fas fa-plus"></i> Add Bill
            </button>
            <button onclick="deleteSelectedRows()" class="btn btn-warning mb-2 mb-md-0" id="deleteSelectedBtn" style="display: none;">
                <i class="fas fa-trash-alt"></i> Delete Selected
            </button>
            <button onclick="exportToExcel()" class="btn btn-success mb-2 mb-md-0" title="Ctrl/Cmd + E">
                <i class="fas fa-file-excel"></i> Export to Excel
            </button>
            <button onclick="exportToPDF()" class="btn btn-danger mb-2 mb-md-0" title="Ctrl/Cmd + P">
                <i class="fas fa-file-pdf"></i> Export to PDF
            </button>
            <button onclick="importFromExcel()" class="btn btn-info mb-2 mb-md-0">
                <i class="fas fa-file-upload"></i> Import Excel
            </button>
            <button onclick="window.print()" class="btn btn-secondary no-print">
                <i class="fas fa-print"></i> Print
            </button>
            <button onclick="copyToClipboard()" class="btn btn-outline-primary">
                <i class="fas fa-copy"></i> Copy Totals
            </button>
        </div>
        <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleExcelImport(event)" />

        <div class="mt-4 p-3 bg-light border rounded text-center">
            <div class="row">
                <div class="col-md-4 col-12">
                    <strong>Total Billed Amount:</strong> â‚¹<span id="totalBilled">0.00</span>
                </div>
                <div class="col-md-4 col-12">
                    <strong>Total Deducted:</strong> â‚¹<span id="totalDeducted">0.00</span>
                </div>
                <div class="col-md-4 col-12">
                    <strong>Total Amount Received:</strong> â‚¹<span id="totalReceived">0.00</span>
                </div>
            </div>
            <div class="mt-2">
                <strong>Total Deduction Percentage & Type:</strong>
                <span id="totalDeductionPercentage">0.00%</span>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Handle install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show custom install button after a delay
            setTimeout(() => {
                if (deferredPrompt && typeof toastr !== 'undefined') {
                    toastr.info(
                        '<div style="cursor: pointer;" onclick="installPWA()">ðŸ“± Install this app for offline access and better experience!</div>',
                        'Install App',
                        {
                            closeButton: true,
                            timeOut: 0,
                            extendedTimeOut: 0,
                            tapToDismiss: false,
                            positionClass: 'toast-bottom-center'
                        }
                    );
                }
            }, 3000);
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                        if (typeof toastr !== 'undefined') {
                            toastr.success('App installed successfully! ðŸŽ‰');
                        }
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Check if app is installed
        window.addEventListener('appinstalled', () => {
            console.log('PWA installed');
            if (typeof toastr !== 'undefined') {
                toastr.success('App installed! You can now use it offline. ðŸŽ‰');
            }
        });

        // Handle URL shortcuts
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');
            
            if (action === 'add') {
                setTimeout(() => addRow(), 500);
            } else if (action === 'export') {
                setTimeout(() => exportToExcel(), 500);
            }
        });
    </script>
    <script src="script.js"></script>
</body>

</html>